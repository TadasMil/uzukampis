---
import CountdownTimer from './CountdownTimer.astro';

const baseUrl = import.meta.env.BASE_URL;
const heroImages = [
  `${baseUrl}assets/hero-header-1.webp`,
  `${baseUrl}assets/hero-header-2.webp`,
  `${baseUrl}assets/hero-header-3.webp`,
  `${baseUrl}assets/hero-header-4.webp`
];
---

<section class="hero-carousel">
  <div class="carousel-container">
    {heroImages.map((img, index) => (
      <div class="carousel-slide" data-active={index === 0 ? 'true' : 'false'}>
        <img src={img} alt={`Hero ${index + 1}`} />
      </div>
    ))}
  </div>

  <CountdownTimer targetDate="2026-03-01T00:00:00" />

  <div class="carousel-dots">
    {heroImages.map((_, index) => (
      <button class={`dot ${index === 0 ? 'active' : ''}`} data-index={index} aria-label={`Go to slide ${index + 1}`}></button>
    ))}
  </div>
</section>

<script>
  let currentSlide = 0;
  const slides = document.querySelectorAll('.carousel-slide');
  const dots = document.querySelectorAll('.dot');
  const totalSlides = slides.length;
  let autoAdvance = null;

  function showSlide(index) {
    slides.forEach((slide, i) => {
      slide.dataset.active = i === index ? 'true' : 'false';
    });
    dots.forEach((dot, i) => {
      dot.classList.toggle('active', i === index);
    });
    currentSlide = index;
  }

  function nextSlide() {
    const next = (currentSlide + 1) % totalSlides;
    showSlide(next);
  }

  function startAutoAdvance() {
    if (autoAdvance) clearInterval(autoAdvance);
    autoAdvance = setInterval(nextSlide, 4000);
  }

  // Auto-advance every 4 seconds
  startAutoAdvance();

  // Dot navigation
  dots.forEach((dot, index) => {
    dot.addEventListener('click', () => {
      clearInterval(autoAdvance); // Stop auto-advance when user interacts
      showSlide(index);
      // Restart auto-advance after 5 seconds of no interaction
      setTimeout(startAutoAdvance, 5000);
    });
  });

  // Initialize
  showSlide(0);
</script>

<style>
  .hero-carousel {
    position: relative;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    max-width: 100%;
  }

  .carousel-container {
    position: relative;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #0F172A 0%, #1e293b 50%, #334155 100%);
  }

  .carousel-slide {
    position: absolute;
    width: 100%;
    height: 100%;
    opacity: 0;
    transition: opacity 0.5s ease-in-out;
  }

  .carousel-slide[data-active="true"] {
    opacity: 1;
  }

  /* Desktop: contain with letterboxing */
  @media (min-width: 769px) {
    .carousel-slide img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
  }

  /* Mobile: cover with animated pan */
  @media (max-width: 768px) {
    .carousel-slide img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      animation: panLeftRight 16s ease-in-out infinite;
    }
  }

  @keyframes panLeftRight {
    0%, 100% {
      object-position: 30% center;
    }
    50% {
      object-position: 70% center;
    }
  }

  .carousel-dots {
    position: absolute;
    bottom: 40px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 12px;
    z-index: 10;
  }

  .dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.5);
    border: none;
    cursor: pointer;
    transition: background 0.3s;
  }

  .dot:hover {
    background: rgba(255, 255, 255, 0.8);
  }

  .dot.active {
    background: white;
  }
</style>
